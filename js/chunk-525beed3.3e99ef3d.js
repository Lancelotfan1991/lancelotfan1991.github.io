(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-525beed3"],{"44bf":function(s,n,a){"use strict";var t=a("c346"),e=a.n(t);e.a},"5a39":function(s,n,a){"use strict";var t=a("8088"),e=a.n(t);e.a},6073:function(s,n,a){s.exports=a.p+"img/back-top.e27cd48e.svg"},8088:function(s,n,a){},c346:function(s,n,a){},f574:function(s,n,a){"use strict";a.r(n);var t=function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("div",{staticClass:"chartPage"},[s._v(" Vue响应式源码 "),a("div",{staticClass:"markdown-container"},[a("VueReactive",{staticClass:"markdowns"})],1),a("BackTop")],1)},e=[],r=function(){var s=this,n=s.$createElement;s._self._c;return s._m(0)},l=[function(){var s=this,n=s.$createElement,t=s._self._c||n;return t("div",[t("img",{staticClass:"backtop",attrs:{src:a("6073"),alt:""}})])}],p={},v=p,_=(a("5a39"),a("2877")),c=Object(_["a"])(v,r,l,!1,null,null,null),o=c.exports,h=function(){var s=this,n=s.$createElement;s._self._c;return s._m(0)},i=[function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("section",[a("h1",[s._v("Vue响应式的实现")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[a("span",{pre:!0,attrs:{class:"hljs-class"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("FanVue")])]),s._v("{\n\n "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("constructor")]),s._v("(options){\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//保存数据")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$options=options;\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$data="),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$options.data;\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$el="),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$options.el;\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//将data添加到响应式系统")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Observer("),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$data);\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//代理this.$data中的数据")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("Object")]),s._v(".keys("),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$data).forEach("),a("span",{pre:!0,attrs:{class:"hljs-function"}},[a("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("key")]),s._v("=>")]),s._v("{\n\n   "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v("._proxy(key);\n\n  });\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//处理el下面的所有节点")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Compiler("),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$el,"),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(");\n\n }\n\n "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//设置代理。这样可以直接使用this.message===xxx")]),s._v("\n\n "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//来代替this.$data.message")]),s._v("\n\n _proxy(key){\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("Object")]),s._v(".defineProperty("),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(",key,{\n\n   "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("configurable")]),s._v(":"),a("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("true")]),s._v(",\n\n   "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("enumerable")]),s._v(":"),a("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("true")]),s._v(",\n\n   "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("set")]),s._v("(newValue){\n\n​    "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$data[key]=newValue;\n\n   },\n\n   "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("get")]),s._v("(){\n\n​    "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$data[key];\n\n   }\n\n  })\n\n }\n\n}\n\n\n\n"),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//添加观察者")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//观察者的主要功能是重新定义每个data的get和set方法")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//使data里数据的获取和修改能被监听")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"hljs-class"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("Observer")])]),s._v("{\n\n \n\n "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("constructor")]),s._v("(data){\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".data=data;\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("Object")]),s._v(".keys(data).forEach("),a("span",{pre:!0,attrs:{class:"hljs-function"}},[a("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("key")]),s._v(" =>")]),s._v(" {\n\n   "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".defineReactive(data,key,data[key]);\n\n  });\n\n }\n "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//定义响应式")]),s._v("\n\n defineReactive(data,key,value){\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//每添加一个响应式的对象，则为其创建一个Dep对象")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" dep="),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Dep();\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("Object")]),s._v(".defineProperty(data,key,{\n\n   "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("enumerable")]),s._v(":"),a("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("true")]),s._v(","),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//该属性的描述符才能够改变")]),s._v("\n\n   "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("configurable")]),s._v(":"),a("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("false")]),s._v(","),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//该属性会出现在枚举属性中")]),s._v("\n\n   "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("get")]),s._v("(){\n\n​    "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//当通过compiler初次编译dom节点时，可以获取到所有的依赖")]),s._v("\n\n​    "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//将这些依赖跟对应的属性绑定起来")]),s._v("\n\n​    "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//添加到一个Dep的subscribers数组里面。")]),s._v("\n\n​    "),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log(Dep.target);\n\n​    "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//每一个Dep的target指向的一个watcher对象。")]),s._v("\n\n​    "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v("(Dep.target){ "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//只有初次Watcher添加依赖的时候，才会添加订阅者，之后不会再添加，为null")]),s._v("\n\n​     dep.addSub(Dep.target)\n\n​    }\n\n​    "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" value;\n\n   },\n\n   "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("set")]),s._v("(newVal){\n\n​    "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v("(newVal===value){\n\n​     "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(";\n\n​    }\n\n​    value=newVal;\n\n​    dep.notify();\n\n   }\n\n  })\n\n }\n\n}\n\n\n\n"),a("span",{pre:!0,attrs:{class:"hljs-class"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("Watcher")])]),s._v("{\n\n "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("constructor")]),s._v("(node,name,vm){\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".node=node;\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".name=name;\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".vm=vm;\n\n\n\n  Dep.target="),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(";\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".update();\n\n  Dep.target="),a("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("null")]),s._v(";\n\n  \n\n }\n\n "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//通知变化")]),s._v("\n\n update(){\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".node.nodeValue="),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".vm["),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".name]\n\n }\n\n}\n\n\n\n"),a("span",{pre:!0,attrs:{class:"hljs-class"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("Dep")])]),s._v("{\n\n "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("constructor")]),s._v("(){\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".subscribers=[];\n\n }\n\n\n\n addSub(sub){\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".subscribers.push(sub);\n\n }\n\n\n\n notify(){\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".subscribers.forEach("),a("span",{pre:!0,attrs:{class:"hljs-function"}},[a("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("sub")]),s._v("=>")]),s._v("{\n\n   sub.update();\n\n  })\n\n }\n\n}\n\n"),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//将原本的页面进行重新编译")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" regExp="),a("span",{pre:!0,attrs:{class:"hljs-regexp"}},[s._v("/\\{\\{(.*)\\}\\}/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//识别双大括号的正则表达式")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"hljs-class"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("Compiler")])]),s._v("{\n\n "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("constructor")]),s._v("(el,vm){\n\n\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".el="),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".querySelector(el);\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log("),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".el);\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".vm=vm;\n\n\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".frag="),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v("._createFragment();\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".el.appendChild("),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".frag);\n\n\n\n }\n\n\n\n _createFragment(){\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" frag="),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".createDocumentFragment();\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" child;\n\n\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("while")]),s._v("(child="),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".el.firstChild){\n\n   "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v("._compile(child);\n\n   frag.appendChild(child);\n\n  }\n\n\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" frag;\n\n }\n\n\n\n _compile(node){\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log(node.nodeType);\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v("(node.nodeType == "),a("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("){\n\n   "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" attrs=node.attributes;\n\n   "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v("(attrs.hasOwnProperty("),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'v-model'")]),s._v(")){\n\n​    "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" name=attrs["),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'v-model'")]),s._v("].nodeValue;\n\n​    node.addEventListener("),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'input'")]),s._v(",e=>{\n\n​     "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".vm[name]=e.target.value;\n\n​    })\n\n   }\n\n\n\n   "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v("("),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" i="),a("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(";i<node.childNodes.length;i++){\n\n\t   "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v("._compile(node.childNodes[i]);\n\n   }\n\n  }\n\n\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v("(node.nodeType === "),a("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("3")]),s._v("){\n\n   "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v("(regExp.test(node.nodeValue)){\n\n​    "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" name="),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("RegExp")]),s._v(".$"),a("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1.")]),s._v("trim();\n\n​    "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Watcher(node,name,"),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".vm);\n\n   }\n\n  }\n\n }\n\n}\n")])])])}],d={},j=Object(_["a"])(d,h,i,!1,null,null,null),u=j.exports,y={components:{VueReactive:u,BackTop:o}},k=y,m=(a("44bf"),Object(_["a"])(k,t,e,!1,null,"43b5cfc0",null));n["default"]=m.exports}}]);
//# sourceMappingURL=chunk-525beed3.3e99ef3d.js.map