<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AR展示活动</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalabled=no,maximum-scale=1.0,minimum-scale=1.0">
    <script
        src="https://cdn.jsdelivr.net/gh/aframevr/aframe@9be0a6b94b61740c6fc4d2a1e74d744c38be4c61/dist/aframe-master.min.js"></script>
    <script src="./libs/aframe-ar-nft-user.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="./libs/look-at-camera.js"></script>
    <link rel="stylesheet" href="./style.css?v=0.39">
    <script src="http://html2canvas.hertzen.com/dist/html2canvas.js"></script>
</head>

<body style='margin : 0px; overflow: hidden;'>
    <p class='content' id='content'></p>
    
    <script>
        const departMentInfo = [
            {
                department: 'MAE',
                owner: '朱良胜',
                content: `MAE是面向5G时代移动网络的自动化引擎，助力实现移动网络的三大超越：1) Beyond Efficiency: 10x运维效率提升；2) Beyond Performance: 20%的频谱效率提升：从不可能到可能；优化从静态到动态；从粗放到精细化；从非实时到实时；3) Beyond New Service：5x发放效率提升；业务发放从weeks到Days；通过联合运营商开放合作，面向场景逐级演进，实现移动网络完全自动驾驶。`,
                link: ''
            },
            {
                department: 'xExpress',
                owner: '卢江涛',
                content: '高效建网的xExpress系列包含Site Express、Feature Express和Radio Express，简化了原本操作复杂、数量庞大的建网工作，支持大批量、流水线式、自动化的建站和特性开通。',
                link: ''
            },
            {
                department: 'xSuite',
                owner: '苏建波',
                content: '敏捷业务的xSuite系列包含WTTx Suite、切片运维管理、室内可视化，支持快速精准的发放业务。',
                link: ''
            },
            {
                department: 'xTurbo',
                owner: '张永生',
                content: '智能运维的xTurbo系列包含Alarm Turbo、Capacity Turbo和Power Turbo，提供智能化的排障、网优、节能能力。',
                link: ''
            },
            {
                department: 'Dopra',
                owner: '梁继成',
                content: 'DOPRA业务包含SSP、VISP、VPP、FSP、SiteAI、AutoTBP，分布杭州、上海、东莞三地域，上海地域交付VISP，AutoTBP,提供轻量级弹性协议栈、IP路由、IP协议安全、拓展集中路径控制引擎、车载安全协议，构筑边缘组网极简竞争力。',
                link: ''
            },
            {
                department: 'AI',
                owner: '朱良胜',
                content: 'Beyond Intelligence：从自动化到智能化，面向云化AI打造自学习自管理的网络，编织一张会思考的"网"，让沟通畅行无阻。',
                link: ''
            }
        ];

        // AFRAME.registerComponent('shot', {
        //     init: function() {
        //         document.getElementById('takePicture').addEventListener(
        //             'mousedown',
        //             ()=>{
        //                 document.querySelector('a-scene').components.screenshot.getCanvas('perspective');
        //                 document.querySelector('a-scene').components.screenshot.capture('perspective')
        //             }
        //         )
        //     }
        // });    

        for(let i = 0; i < 2; i ++) {
            AFRAME.registerComponent('markerhandler' + i, {
                init: function () {
                    const marker = this.el;
                    const self = this;
                    this.el.addEventListener('markerFound', () => {
                        document.getElementById('debuginfo').innerHTML='marker found ' + i;
                        document.getElementById('content').style.display='block';
                        document.getElementById('content').innerHTML=departMentInfo[i].content;
                    });
                    this.el.addEventListener('markerLost', () => {
                        document.getElementById('content').style.display='none';
                    });
                }
            });
        }
    </script>

    <a-scene
        vr-mode-ui="enabled: false;"
        shot
        embedded
        arjs='trackingMethod: best; debugUIEnabled: false;detectionMode: mono_and_matrix; matrixCodeType: 4x4_BCH_13_5_5; sourceType: webcam; '>
        
        <a-box height='2' color='red' width='1'></a-box>

        <a-marker markerhandler0 type='barcode' value='0' id='1'></a-marker>

        <a-marker markerhandler1 type='barcode' value='2' id='2'></a-marker>

        <a-entity camera zoom='1'></a-entity>
    </a-scene>

    <div id='app' >
        <div id='screenShot' v-show='screenShotIcon'>
            <div class="breathe-div"></div>
            <img class='takepicture' id='takePicture' src='./resource/shoot.png' v-on:click='takePicture'/>
            <img class='switchcamera' id='switchcamera' src="./resource/switch-camera.png" v-on:click="switchCamera" alt="">
        </div>

        <div style='position: fixed; bottom: 10px;left: 0px; width:100%; text-align: left;font-size: 10px;color:white'>version:{{version}}<br>{{versionInfo}}</div>
        <div id='debuginfo' style='position: fixed; bottom: 40px;left: 0px; width:100%; text-align: left;font-size: 10px;color:white'>debuginfo: empty</div>

        <div class='screenShotDiv' v-show='isShooted'>
            <canvas id='canvas' class='screenShot'></canvas>
            <img class='screenShot' :src="screenShotImage" alt="">
            <p class='hint'>长按图片可保存至手机</p>
            <img src="./resource/delete.png" class='delete' v-on:click="hideImage"/>
        </div>
    </div>

    <script>
        const app = new Vue(
            {
                el: '#app',
                data: {
                    version: '0.39',
                    versionInfo: "添加多个marker,采用界面ui的形式展现文案,并捕获摄像机",
                    screenShotIcon : true,
                    isShooted: false,
                    screenShotImage: '',
                },
                methods: {
                    takePicture(){
                        const self = this;
                        document.getElementById('screenShot').style.display='none';
                        var aVideo = document.getElementById('arjs-video');
                        var aCanvas = document.getElementById('canvas');
                        var ctx = aCanvas.getContext('2d');
                        ctx.drawImage(aVideo, 0, 0, 3200, 5000, 0 ,0, 2138, 2500);

                        html2canvas(
                            document.getElementById('app'),
                            {
                                allowTaint: true,
                                useCORS: true,
                                canvas: aCanvas
                            }
                        ).then(function (canvas) {
                            self.screenShotImage = canvas.toDataURL("image/png");

                            self.isShooted = true;
                            self.screenShotIcon = false;
                        })
                        console.log(document.body.clientWidth);        //网页可d见区域宽(body)
                        console.log(document.body.clientHeight);       //网页可见区域高(body)
                        console.log(document.body.offsetWidth);       //网页可见区域宽(body)，包括border、margin等
                        console.log(document.body.offsetHeight);      //网页可见区域宽(body)，包括border、margin等
                    },
                    hideImage(){
                        this.isShooted = false;
                        this.screenShotImage = "";
                        this.screenShotIcon = true;
                        document.getElementById('screenShot').style.display='block';
                    },
                    switchCamera(){
                        window.location.href="./ar-user.html"
                    }
                }
            }
        );
    </script>
</body>

</html>